<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - InternMatch AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- (Your Existing CSS Styles are kept here for styling) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); color: #333; line-height: 1.6; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; margin-bottom: 30px; }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo i { font-size: 2.5rem; color: #4361ee; }
        .logo h1 { font-size: 2.2rem; background: linear-gradient(90deg, #4361ee 0%, #3a0ca3 100%);  -webkit-background-clip : text;  -webkit-text-fill-color : transparent; }
        nav ul { display: flex; list-style: none; gap: 25px; }
        nav a { text-decoration: none; color: #4a4e69; font-weight: 600; transition: color 0.3s; }
        nav a:hover , nav a.active { color: #4361ee; }
        .page-header { background: linear-gradient(120deg, #3a0ca3 0%, #4361ee 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; }
        .page-header h2 { font-size: 2.2rem; margin-bottom: 15px; }
        .page-header p { font-size: 1.2rem; opacity: 0.9; max-width: 700px; margin: 0 auto; }
        .profile-container { display: grid; grid-template-columns: 1fr 2fr; gap: 25px; margin-bottom: 40px; }
        .profile-sidebar { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); text-align: center;
        position: relative; }
        .profile-image-container { position: relative; width: 150px; margin: 0 auto 20px; }
        .profile-image { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 5px solid #f0f0f0; cursor: pointer; transition: all 0.3s;
        }
        .profile-image:hover { opacity: 0.9; transform: scale(1.02); }
        .profile-edit-icon { position: absolute; bottom: 10px; right: 10px; background: #4361ee; color: white; width: 36px; height: 36px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2); transition: all 0.3s; }
        .profile-edit-icon:hover { background: #3a0ca3; transform: scale(1.1); }
        .profile-name { font-size: 1.5rem; color: #3a0ca3; margin-bottom: 5px; }
        .profile-title { color: #6c757d; margin-bottom: 20px; }
        .profile-contact { display: flex; flex-direction: column; gap: 10px; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .contact-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: #4a4e69; }
        .contact-item i { color: #4361ee; width: 20px; }
        .profile-stats { display: flex; justify-content: space-around; margin: 25px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .stat { text-align: center; }
        .stat-number { font-size: 1.5rem; font-weight: 700; color: #4361ee; }
        .stat-label { font-size: 0.9rem; color: #6c757d; }
        .profile-badges { margin: 25px 0; }
        .badge { display: inline-flex; align-items: center; gap: 5px; background: #f8f9fa; padding: 8px 15px; border-radius: 20px; margin: 5px; font-size: 0.9rem;
        color: #4a4e69; }
        .badge i { color: #4361ee; }
        .profile-completion { margin: 25px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .completion-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .completion-bar { height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden; }
        .completion-progress { height: 100%; background: linear-gradient(90deg, #4361ee 0%, #3a0ca3 100%); border-radius: 4px; width: 0%; transition: width 1s ease-in-out; }
        .profile-actions { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; background: #4361ee; color: white; padding: 12px 25px; border-radius: 50px;
        text-decoration: none; font-weight: 600; transition: all 0.3s; border: none; cursor: pointer; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); }
        .btn-outline { background: transparent; color: #4361ee; border: 2px solid #4361ee; }
        .btn-sm { padding: 8px 15px; font-size: 0.9rem; }
        .profile-content { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); }
        .section-title { font-size: 1.5rem; color: #3a0ca3; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; display: flex; align-items: center;
        justify-content: space-between; }
        .edit-section { font-size: 1rem; color: #4361ee; cursor: pointer; background: none; border: none; display: flex; align-items: center; gap: 5px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .info-item { margin-bottom: 15px; }
        .info-label { font-size: 0.9rem; color: #6c757d; margin-bottom: 5px; }
        .info-value { font-size: 1.1rem; color: #4a4e69; font-weight: 500; }
        .skills-container { margin-bottom: 30px; }
        .skills-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .skill-pill { background: #f0f0f0; padding: 8px 15px; border-radius: 20px; font-weight: 500; color: #4a4e69; display: flex; align-items: center; gap: 5px;
        }
        .skill-pill.primary { background: #4361ee; color: white; }
        .progress-container { margin-bottom: 30px; }
        .progress-item { margin-bottom: 15px; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .progress-bar { height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4361ee 0%, #3a0ca3 100%); border-radius: 4px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .tab { padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: 600; color: #6c757d; transition: all 0.3s; }
        .tab.active { background: #4361ee; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .application-card { border: 1px solid #eee; border-radius: 10px; padding: 20px; margin-bottom: 15px; transition: transform 0.3s; }
        .application-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); }
        .app-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .app-company { font-weight: 600; color: #3a0ca3; }
        .app-date { color: #6c757d; font-size: 0.9rem; }
        .app-status { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-accepted { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .recent-activity { margin-top: 30px; }
        .activity-item { display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #4361ee; }
        .activity-content { flex: 1; }
        .activity-title { font-weight: 600; margin-bottom: 5px; }
        .activity-time { font-size: 0.8rem; color: #6c757d; }
        footer { text-align: center; padding: 30px 0; color: #6c757d; margin-top: 40px; border-top: 1px solid #ddd; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2); width: 90%;
        max-width: 500px; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .modal-title { font-size: 1.5rem; color: #3a0ca3; }
        .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6c757d; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #4a4e69; }
        .form-input , .form-textarea , .form-select { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px;
        font-size: 1rem; transition: border-color 0.3s; }
        .form-input:focus , .form-textarea:focus , .form-select:focus { border-color: #4361ee; outline: none; }
        .form-textarea { min-height: 100px; resize: vertical; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .skill-input-container { display: flex; gap: 10px; margin-bottom: 15px; }
        .skill-tag { display: inline-flex; align-items: center; background: #f0f0f0; padding: 5px 12px; border-radius: 20px; margin: 5px; font-size: 0.9rem; }
        .skill-tag .remove-skill { margin-left: 5px; cursor: pointer; color: #6c757d; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 20px; }
        .profile-picture-options { display: flex; flex-direction: column; gap: 20px; margin: 20px 0; }
        .picture-option { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 15px; border: 2px solid #f0f0f0; border-radius: 10px;
        cursor: pointer; transition: all 0.3s; }
        .picture-option:hover { border-color: #4361ee; background-color: #f8f9ff; }
        .picture-option.active { border-color: #4361ee; background-color: #f0f4ff; }
        .picture-preview { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #f0f0f0; }
        .upload-btn { display: inline-block; padding: 10px 20px; background: #4361ee; color: white; border-radius: 5px; cursor: pointer; text-align: center;
        transition: background 0.3s; }
        .upload-btn:hover { background: #3a0ca3; }
        #file-input { display: none; }
        .avatar-options { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .avatar-option { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; cursor: pointer; border: 2px solid #f0f0f0; transition: all 0.3s;
        }
        .avatar-option:hover , .avatar-option.selected { border-color: #4361ee; transform: scale(1.1); }
        @media (max-width: 900px) { .profile-container { grid-template-columns: 1fr; } .info-grid { grid-template-columns: 1fr;
        } .form-grid { grid-template-columns: 1fr; } .avatar-options { grid-template-columns: repeat(3, 1fr); } }
        /* ✨ Application Details Modal Styling */
#application-details-modal .modal-content {
  background: #ffffff;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(67, 97, 238, 0.2);
  animation: modalFadeIn 0.3s ease-out;
  padding: 30px;
  position: relative;
  overflow: hidden;
}

#application-details-modal .modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid #f0f0f5;
  padding-bottom: 10px;
}

#application-details-modal .modal-title {
  font-size: 1.4rem;
  font-weight: 700;
  color: #3a0ca3;
  display: flex;
  align-items: center;
  gap: 10px;
}

#application-details-modal .modal-title i {
  color: #4361ee;
  font-size: 1.3rem;
}

#application-details-modal .close-modal {
  background: transparent;
  border: none;
  font-size: 1.5rem;
  color: #6c757d;
  cursor: pointer;
  transition: all 0.3s ease;
}

#application-details-modal .close-modal:hover {
  color: #3a0ca3;
  transform: scale(1.1);
}

#application-details-modal .modal-body {
  margin-top: 15px;
  line-height: 1.7;
  color: #444;
  font-size: 1rem;
}

#application-details-modal .modal-body strong {
  color: #3a0ca3;
  display: inline-block;
  width: 110px;
}

#application-details-modal .modal-body p {
  margin-bottom: 10px;
}

#application-details-modal .modal-body #detail-status {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-weight: 600;
  color: #fff;
}

#application-details-modal .modal-body #detail-status::before {
  content: "● ";
}

/* ✅ Dynamic colors for statuses */
#application-details-modal .modal-body #detail-status:contains("Accepted") {
  background-color: #28a745;
}
#application-details-modal .modal-body #detail-status:contains("Rejected") {
  background-color: #dc3545;
}
#application-details-modal .modal-body #detail-status:contains("Pending") {
  background-color: #ffc107;
  color: #333;
}

#application-details-modal .modal-actions {
  display: flex;
  justify-content: center;
  margin-top: 25px;
}

#application-details-modal .modal-actions .btn {
  padding: 10px 25px;
  border-radius: 50px;
  font-weight: 600;
  font-size: 0.95rem;
  background: linear-gradient(90deg, #4361ee, #3a0ca3);
  color: #fff;
  border: none;
  cursor: pointer;
  box-shadow: 0 3px 15px rgba(67, 97, 238, 0.3);
  transition: all 0.3s ease;
}

#application-details-modal .modal-actions .btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 20px rgba(58, 12, 163, 0.4);
}

/* ✨ Subtle entry animation */
@keyframes modalFadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(67, 97, 238, 0.15); /* soft blue overlay */
  backdrop-filter: blur(4px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  animation: fadeInBackdrop 0.4s ease;
}

@keyframes fadeInBackdrop {
  from { opacity: 0; }
  to { opacity: 1; }
}

.btn-change {
  background: #4361ee;
  color: white;
  border: none;
}
.btn-change:hover {
  background: #3a0ca3;
}


    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-brain"></i>
                <h1>InternMatch AI</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="HomePage.html">Home</a></li>
                    <!-- <li><a href="Internship_Section.html">Internships</a></li> -->
                     <li><a href="match.html">InternMatch</a></li>
                    <li><a href="Profile_Section.html" class="active">Profile</a></li>
                </ul>
            </nav>
        </header>
        <section class="page-header">
            <h2>Your Profile</h2>
            <p id="header-text">Manage your information, track your applications, and improve your matching score</p>
        </section>
        <div class="profile-container">
            <div class="profile-sidebar">
                <div class="profile-image-container">
                    <img src="https://placehold.co/150x150/CCCCCC/6C757D?text=SETUP" alt="Profile" class="profile-image" id="profile-picture">
                    <div class="profile-edit-icon" onclick="openModal('profile-picture-modal')">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <h2 class="profile-name" id="profile-name"></h2>
                <p class="profile-title" id="profile-title"></p>
                <div class="profile-contact">
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <span id="profile-email"></span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <span id="profile-phone"></span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span id="profile-location"></span>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="stat">
                        <div class="stat-number" id="stat-score">0%</div>
                        <div class="stat-label">Profile Score</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="applications-count">0</div>
                        <div class="stat-label">Applications</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="matches-count">0</div>
                        <div class="stat-label">Matches</div>
                    </div>
                </div>
                <div class="profile-completion">
                    <div class="completion-header">
                        <span>Profile Completion</span>
                        <span id="completion-percentage"></span>
                    </div>
                    <div class="completion-bar">
                        <div class="completion-progress"></div>
                    </div>
                    <p style="font-size: 0.8rem; margin-top: 10px; color: #6c757d;">Complete your profile to get better matches</p>
                </div>
                <div class="profile-badges">
                    <div class="badge"><i class="fas fa-home"></i> Rural Candidate</div>
                    <div class="badge"><i class="fas fa-map-marker-alt"></i> Aspirational District</div>
                    <div class="badge"><i class="fas fa-users"></i> Diversity Focus</div>
                </div>
                <div class="profile-actions">
                    <button class="btn"><i class="fas fa-download"></i> Download Resume</button>
                    <button class="btn btn-outline" onclick="openModal('profile-modal')"><i class="fas fa-edit"></i> Edit Profile</button>
                    <button class="btn btn-outline btn-sm"><i class="fas fa-share-alt"></i> Share Profile</button>
                    <button class="btn btn-outline btn-sm" onclick="openModal('set-password-modal')">
                        <i class="fas fa-lock"></i> Set Password
                    </button>
                </div>
            </div>
            <div class="profile-content">
                <div class="tabs">
                    <div class="tab active" data-tab="overview">Overview</div>
                    <div class="tab" data-tab="education">Education</div>
                    <div class="tab" data-tab="applications">Applications</div>
                    <div class="tab" data-tab="achievements">Achievements</div>
                </div>
                <div class="tab-content active" id="overview-tab">
                    <h3 class="section-title">
                        <span><i class="fas fa-user"></i> About Me</span>
                        <button class="edit-section" onclick="openModal('about-modal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </h3>
                    <p id="about-me-text" style="margin-bottom: 25px; color: #4a4e69;"></p>
                    <h3 class="section-title">
                        <span><i class="fas fa-star"></i> Skills & Expertise</span>
                        <button class="edit-section" onclick="openModal('skills-modal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </h3>
                    <div class="skills-container">
                        <div id="skills-list" class="skills-list">
                        </div>
                    </div>
                    <h3 class="section-title">
                        <span><i class="fas fa-bullseye"></i> Career Preferences</span>
                        <button class="edit-section" onclick="openModal('career-modal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Preferred Role</div>
                            <div class="info-value" id="preferred-role"></div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Internship Type</div>
                            <div class="info-value" id="internship-type"></div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Preferred Location</div>
                            <div class="info-value" id="preferred-location"></div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Expected Stipend</div>
                            <div class="info-value" id="expected-stipend"></div>
                        </div>
                    </div>
                    <h3 class="section-title"><i class="fas fa-trophy"></i> Top Matches</h3>
                    <div class="skills-container">
                        <div class="skills-list">
                            <div class="skill-pill" style="background: #e6f7ff;">Data Science: 94% Match</div>
                            <div class="skill-pill" style="background: #e6f7ff;">ML Engineer: 88% Match</div>
                            <div class="skill-pill" style="background: #e6f7ff;">Backend Dev: 82% Match</div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="education-tab">
                    <h3 class="section-title">
                        <span><i class="fas fa-graduation-cap"></i> Education</span>
                        <button class="edit-section" onclick="openModal('education-modal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </h3>
                    
                    <div class="progress-item" id="education-item-1">
                        <div class="activity-item" style="border: none; padding: 0 0 15px 0;">
                            <div class="activity-icon"><i class="fas fa-graduation-cap"></i></div>
                            <div class="activity-content">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="activity-title"></span>
                                    <span class="activity-time"></span>
                                </div>
                                <p style="color: #4a4e69; font-weight: 500; margin-bottom: 5px;"></p>
                                <p style="color: #6c757d; font-size: 0.9rem;"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-item" id="education-item-2">
                        <div class="activity-item" style="border: none; padding: 15px 0; border-top: 1px solid #f0f0f0;">
                            <div class="activity-icon"><i class="fas fa-graduation-cap"></i></div>
                            <div class="activity-content">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="activity-title"></span>
                                    <span class="activity-time"></span>
                                </div>
                                <p style="color: #4a4e69; font-weight: 500; margin-bottom: 5px;"></p>
                                <p style="color: #6c757d; font-size: 0.9rem;"></p>
                            </div>
                        </div>
                    </div>

                    <h3 class="section-title" style="margin-top: 20px;">
                        <span><i class="fas fa-certificate"></i> Certifications</span>
                        <button class="edit-section" onclick="openModal('certifications-modal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </h3>
                    
                    <div class="progress-item" id="certification-item-1">
                        <div class="activity-item" style="border: none; padding: 0 0 15px 0;">
                            <div class="activity-icon"><i class="fas fa-certificate"></i></div>
                            <div class="activity-content">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="activity-title"></span>
                                    <span class="activity-time"></span>
                                </div>
                                <p style="color: #4a4e69; font-weight: 500; margin-bottom: 5px;"></p>
                            </div>
                        </div>
                    </div>
                    <div class="progress-item" id="certification-item-2"></div>
                </div>
                
                <div class="tab-content" id="applications-tab">
                    <h3 class="section-title">
                        <span><i class="fas fa-file-alt"></i> Recent Applications</span>
                        <button class="edit-section" onclick="openModal('applications-modal')"></button>
                    </h3>

                    <!-- ✅ This is where your backend data will load -->
                    <div id="recentApplications">
                        <p style="color:#6c757d; text-align:center; padding:18px 0;">
                            Loading your applications...
                        </p>
                    </div>
                </div>

                
                <div class="tab-content" id="achievements-tab">
                    <h3 class="section-title">
                        <span><i class="fas fa-award"></i> Achievements</span>
                        <button class="edit-section" onclick="openModal('achievements-modal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </h3>
                    
                    <div class="progress-item" id="achievement-item-1">
                        <div class="activity-item" style="border: none; padding: 0 0 15px 0;">
                            <div class="activity-icon"><i class="fas fa-award"></i></div>
                            <div class="activity-content">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="activity-title"></span>
                                    <span class="activity-time"></span>
                                </div>
                                <p style="color: #4a4e69; font-weight: 500; margin-bottom: 5px;"></p>
                            </div>
                        </div>
                    </div>
                    <div class="progress-item" id="achievement-item-2"></div>
                    
                    <h3 class="section-title" style="margin-top: 20px;">
                        <span><i class="fas fa-project-diagram"></i> Projects</span>
                        <button class="edit-section" onclick="openModal('projects-modal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </h3>
                    
                    <div class="progress-item" id="project-item-1">
                        <div class="activity-item" style="border: none; padding: 0 0 15px 0;">
                            <div class="activity-icon"><i class="fas fa-project-diagram"></i></div>
                            <div class="activity-content">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="activity-title"></span>
                                    <span class="activity-time"></span>
                                </div>
                                <p style="color: #4a4e69; font-weight: 500; margin-bottom: 5px;"></p>
                                <p style="color: #6c757d; font-size: 0.9rem;"></p>
                            </div>
                        </div>
                    </div>
                    <div class="progress-item" id="project-item-2"></div>
                </div>
                <div class="recent-activity">
                    <h3 class="section-title"><i class="fas fa-history"></i> Recent Activity</h3>
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">Applied for Data Science Intern at TechCorp</div>
                            <div class="activity-time">2 days ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fas fa-user-check"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">Profile completeness increased to <span id="activity-completion"></span></div>
                            <div class="activity-time">3 days ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="activity-content">
                            <div class="activity-title">Accepted for Frontend Developer Intern at FinTech Builders</div>
                            <div class="activity-time">1 week ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer>
        <footer>
            <p>© 2023 InternMatch AI | PM Internship Scheme Initiative</p>
            <p>Smart matching for better opportunities and inclusive growth</p>
        </footer>
    </div>
    
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Profile</h3>
                <button class="close-modal" onclick="closeModal('profile-modal')">&times;</button>
            </div>
            <form id="profile-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="edit-name" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Professional Title</label>
                        <input type="text" class="form-input" id="edit-title" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="edit-email" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" id="edit-phone" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-input" id="edit-location" value="">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('profile-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveProfile()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal" id="profile-picture-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Change Profile Picture</h3>
                <button class="close-modal" onclick="closeModal('profile-picture-modal')">&times;</button>
            </div>
            <div class="profile-picture-options">
                <div class="picture-option" id="upload-option">
                    <h4>Upload a Photo</h4>
                    <label for="file-input" class="upload-btn">
                        <i class="fas fa-upload"></i> Choose File
                    </label>
                    <input type="file" id="file-input" accept="image/*">
                    <p id="file-name" style="font-size: 0.9rem; margin-top: 10px; color: #6c757d;">No file chosen</p>
                </div>
                <div class="picture-option">
                    <h4>Choose an Avatar</h4>
                    <div class="avatar-options">
                        <img src="https://placehold.co/60x60/4361ee/FFFFFF?text=RS" class="avatar-option" onclick="selectAvatar(this, 'https://placehold.co/150x150/4361ee/FFFFFF?text=RS')">
                        <img src="https://placehold.co/60x60/3a0ca3/FFFFFF?text=RS" class="avatar-option" onclick="selectAvatar(this, 'https://placehold.co/150x150/3a0ca3/FFFFFF?text=RS')">
                        <img src="https://placehold.co/60x60/4cc9f0/FFFFFF?text=RS" class="avatar-option" onclick="selectAvatar(this, 'https://placehold.co/150x150/4cc9f0/FFFFFF?text=RS')">
                        <img src="https://placehold.co/60x60/f72585/FFFFFF?text=RS" class="avatar-option" onclick="selectAvatar(this, 'https://placehold.co/150x150/f72585/FFFFFF?text=RS')">
                        <img src="https://placehold.co/60x60/7209b7/FFFFFF?text=RS" class="avatar-option" onclick="selectAvatar(this, 'https://placehold.co/150x150/7209b7/FFFFFF?text=RS')">
                        <img src="https://placehold.co/60x60/4895ef/FFFFFF?text=RS" class="avatar-option" onclick="selectAvatar(this, 'https://placehold.co/150x150/4895ef/FFFFFF?text=RS')">
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('profile-picture-modal')">Cancel</button>
                <button type="button" class="btn" onclick="saveProfilePicture()">Save Changes</button>
            </div>
        </div>
    </div>
    <div class="modal" id="about-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit About Me</h3>
                <button class="close-modal" onclick="closeModal('about-modal')">&times;</button>
            </div>
            <form id="about-form">
                <div class="form-group">
                    <label class="form-label">About Me</label>
                    <textarea class="form-textarea" id="edit-about"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('about-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveAbout()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal" id="skills-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Skills</h3>
                <button class="close-modal" onclick="closeModal('skills-modal')">&times;</button>
            </div>
            <form id="skills-form">
                <div class="form-group">
                    <label class="form-label">Add Skill</label>
                    <div class="skill-input-container">
                        <input type="text" class="form-input" id="new-skill" placeholder="Enter a skill">
                        <button type="button" class="btn btn-sm" onclick="addSkill()">Add</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Skills</label>
                    <div id="skills-container">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('skills-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveSkills()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal" id="career-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Career Preferences</h3>
                <button class="close-modal" onclick="closeModal('career-modal')">&times;</button>
            </div>
            <form id="career-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Preferred Role</label>
                        <input type="text" class="form-input" id="edit-role" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Internship Type</label>
                        <select class="form-select" id="edit-type">
                            <option>On-site</option>
                            <option selected>Remote</option>
                            <option>Hybrid</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preferred Location</label>
                        <input type="text" class="form-input" id="edit-preferred-location" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Expected Stipend (₹)</label>
                        <input type="text" class="form-input" id="edit-stipend" value="">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('career-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveCareer()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal" id="education-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Education</h3>
                <button class="close-modal" onclick="closeModal('education-modal')">&times;</button>
            </div>
            <form id="education-form">
                <div class="form-group">
                    <label class="form-label">Degree 1</label>
                    <input type="text" class="form-input" id="edit-degree1" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Period</label>
                        <input type="text" class="form-input" id="edit-period1" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Institution</label>
                        <input type="text" class="form-input" id="edit-institution1" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Details</label>
                    <input type="text" class="form-input" id="edit-details1" value="">
                </div>
                <hr style="margin: 20px 0;">
                <div class="form-group">
                    <label class="form-label">Degree 2</label>
                    <input type="text" class="form-input" id="edit-degree2" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Period</label>
                        <input type="text" class="form-input" id="edit-period2" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Institution</label>
                        <input type="text" class="form-input" id="edit-institution2" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Details</label>
                    <input type="text" class="form-input" id="edit-details2" value="">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('education-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveEducation()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal" id="certifications-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Certifications</h3>
                <button class="close-modal" onclick="closeModal('certifications-modal')">&times;</button>
            </div>
            <form id="certifications-form">
                <div class="form-group">
                    <label class="form-label">Certification 1</label>
                    <input type="text" class="form-input" id="edit-cert1" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="edit-year1" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Issuing Organization</label>
                        <input type="text" class="form-input" id="edit-org1" value="">
                    </div>
                </div>
                <hr style="margin: 20px 0;">
                <div class="form-group">
                    <label class="form-label">Certification 2</label>
                    <input type="text" class="form-input" id="edit-cert2" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="edit-year2" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Issuing Organization</label>
                        <input type="text" class="form-input" id="edit-org2" value="">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('certifications-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveCertifications()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal" id="achievements-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Achievements</h3>
                <button class="close-modal" onclick="closeModal('achievements-modal')">&times;</button>
            </div>
            <form id="achievements-form">
                <div class="form-group">
                    <label class="form-label">Achievement 1</label>
                    <input type="text" class="form-input" id="edit-ach1-title" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="edit-ach1-year" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Event/Organization</label>
                        <input type="text" class="form-input" id="edit-ach1-event" value="">
                    </div>
                </div>
                <hr style="margin: 20px 0;">
                <div class="form-group">
                    <label class="form-label">Achievement 2</label>
                    <input type="text" class="form-input" id="edit-ach2-title" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="edit-ach2-year" value="">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Event/Organization</label>
                        <input type="text" class="form-input" id="edit-ach2-event" value="">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('achievements-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveAchievements()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal" id="projects-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Projects</h3>
                <button class="close-modal" onclick="closeModal('projects-modal')">&times;</button>
            </div>
            <form id="projects-form">
                <div class="form-group">
                    <label class="form-label">Project 1 Title</label>
                    <input type="text" class="form-input" id="edit-proj1-title" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="edit-proj1-year" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="edit-proj1-desc"></textarea>
                </div>
                <hr style="margin: 20px 0;">
                <div class="form-group">
                    <label class="form-label">Project 2 Title</label>
                    <input type="text" class="form-input" id="edit-proj2-title" value="">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="edit-proj2-year" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="edit-proj2-desc"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('projects-modal')">Cancel</button>
                    <button type="button" class="btn" onclick="saveProjects()">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Application Details Modal -->
        <div class="modal" id="application-details-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-info-circle"></i> Application Details</h3>
            <button class="close-modal" onclick="closeModal('application-details-modal')">&times;</button>
            </div>
            <div class="modal-body" id="application-details-body" style="padding: 15px 0; color: #333;">
            <p><strong>Internship:</strong> <span id="detail-title"></span></p>
            <p><strong>Company:</strong> <span id="detail-company"></span></p>
            <p><strong>Status:</strong> <span id="detail-status"></span></p>
            <p><strong>Applied On:</strong> <span id="detail-date"></span></p>
            <p><strong>Description:</strong> <span id="detail-desc"></span></p>
            </div>
            <div class="modal-actions">
            <button type="button" class="btn btn-outline" onclick="closeModal('application-details-modal')">Close</button>
            </div>
        </div>
        </div>

        <!-- SET PASSWORD MODAL -->
        <div class="modal" id="set-password-modal">
        <div class="modal-content">
            <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-lock"></i> Set Password</h3>
            <button class="close-modal" onclick="closeModal('set-password-modal')">&times;</button>
            </div>
            <form id="setPasswordForm">
            <div class="form-group">
                <label class="form-label">New Password</label>
                <input type="password" id="newPassword" class="form-input" placeholder="Enter new password" required>
            </div>
            <div class="form-group">
                <label class="form-label">Confirm Password</label>
                <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password" required>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('set-password-modal')">Cancel</button>
                <button type="submit" class="btn">Save Password</button>
            </div>
            </form>
        </div>
        </div>


    
    <script>

        // === Profile Picture Upload Preview ===
        document.getElementById('file-input').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('profile-picture').src = e.target.result;
                    document.getElementById('file-name').textContent = file.name;
                    selectedAvatarUrl = e.target.result; // Save base64 image
                };
                reader.readAsDataURL(file); // Convert to base64
            }
        });

    // --- STABILITY FIX: Define showNotification FIRST so other functions can call it ---
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.position = 'fixed';
        notification.style.bottom = '20px';
        notification.style.right = '20px';
        notification.style.backgroundColor = type === 'success' ? '#4361ee' : (type === 'error' ? '#e63946' : '#ffb703');
        notification.style.color = 'white';
        notification.style.padding = '12px 20px';
        notification.style.borderRadius = '5px';
        notification.style.boxShadow = '0 3px 10px rgba(0, 0, 0, 0.2)';
        notification.style.zIndex = '1000';
        notification.style.transition = 'opacity 0.5s';

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 500);
        }, 3000);
    }

    // --- TEMPORARY DATA STORAGE & CONFIGURATION ---
    const CURRENT_USER_ID = localStorage.getItem('current_user_id') || 'test_user_123'; // Using a test ID
    const CURRENT_USER_EMAIL = localStorage.getItem('current_user_email') || 'user@example.com';
    const API_URL = 'http://localhost:3000/api/profile';
    const APPLICATION_API = 'http://localhost:3000/applications';

    
    // UPDATED: Added all new data fields
    const defaultProfileData = {
        name: "New User",
        title: "Complete Your Profile Setup",
        email: CURRENT_USER_EMAIL,
        phone: "",
        location: "",
        picture: "https://placehold.co/150x150/CCCCCC/6C757D?text=SETUP",
        about: "Please fill out this section to help the AI match you with the best internships.",
        skills: [],
        career: { role: "", type: "Remote", location: "", stipend: "0 - 0" },
        education: [],
        certifications: [],
        achievements: [],
        projects: [],
        completionScore: 20
    };

    // --- UTILITY & DATA HANDLING ---
    function getProfileData() {
        const savedData = localStorage.getItem(`profile_${CURRENT_USER_ID}`);
        if (savedData) {
            // Merges saved data with defaults for smooth loading
            const parsedData = JSON.parse(savedData);
            // Ensure career object exists
            parsedData.career = { ...defaultProfileData.career, ...parsedData.career };
            return { ...defaultProfileData, ...parsedData };
        }
        return defaultProfileData;
    }

    function saveProfileData(data) {
        localStorage.setItem(`profile_${CURRENT_USER_ID}`, JSON.stringify(data));
    }

    // --- RENDER FUNCTIONS ---
    function renderSkills(skills) {
        const skillsListDisplay = document.getElementById('skills-list');
        const skillsModalContainer = document.getElementById('skills-container');
        skillsListDisplay.innerHTML = '';
        skillsModalContainer.innerHTML = '';
        
        if (!skills) return;

        skills.forEach((skill, index) => {
            const isPrimary = index < 3;
            // Display list
            const pill = document.createElement('div');
            pill.className = `skill-pill ${isPrimary ? 'primary' : ''}`;
            pill.innerHTML = `<i class="fas fa-code"></i> ${skill}`;
            skillsListDisplay.appendChild(pill);
            // Modal edit list
            const tag = document.createElement('div');
            tag.className = 'skill-tag';
            tag.innerHTML = `${skill} <span class="remove-skill" onclick="removeSkill(this)">×</span>`;
            skillsModalContainer.appendChild(tag);
        });
    }

    // NEW HELPER: To render list items like Education, Projects, etc.
    function renderListItem(containerId, item, iconClass) {
        const container = document.getElementById(containerId);

        // Detect valid data for all item types (education, certs, achievements, etc.)
        const hasContent =
            item &&
            (item.title || item.degree || item.cert_name || item.project_title);

        if (!hasContent) {
            if (['education-item-1', 'education-item-2', 'certification-item-1', 'achievement-item-1', 'project-item-1'].includes(containerId)) {
                return; // Do not overwrite placeholders
            }
            container.innerHTML = `<p style="color: #6c757d; font-style: italic;">No item added.</p>`;
            return;
        }
        
        const title = item.title || item.degree || item.cert_name || item.project_title || '';
        const subtitle = item.institution || item.issuing_org || item.event_org || '';
        const date = item.period || item.year || '';
        const details = item.details || item.description || '';

        container.innerHTML = `
            <div class="activity-item" style="border: none; padding: 0;">
                <div class="activity-icon"><i class="fas ${iconClass}"></i></div>
                <div class="activity-content">
                    <div style="display: flex; justify-content: space-between;">
                        <span class="activity-title">${title}</span>
                        <span class="activity-time">${date}</span>
                    </div>
                    <p style="color: #4a4e69; font-weight: 500; margin-bottom: 5px;">${subtitle}</p>
                    <p style="color: #6c757d; font-size: 0.9rem;">${details}</p>
                </div>
            </div>
        `;
    }


    // --- UPDATED: loadProfile (Now loads ALL data) ---
    function loadProfile(data) {
        const completionPercentage = data.completionScore || 20;

        // 1. Sidebar & Header
        document.getElementById('profile-picture').src = data.picture;
        document.getElementById('profile-name').textContent = data.name;
        document.getElementById('profile-title').textContent = data.title;
        document.getElementById('profile-email').textContent = data.email;
        document.getElementById('profile-phone').textContent = data.phone || 'N/A';
        document.getElementById('profile-location').textContent = data.location || 'N/A';

        document.getElementById('stat-score').textContent = `${completionPercentage}%`;
        document.getElementById('completion-percentage').textContent = `${completionPercentage}%`;
        document.querySelector('.completion-progress').style.width = `${completionPercentage}%`;
        // ✅ NEW: Update total applications dynamically
        if (data.totalApplications !== undefined) {
        const applicationsElement = document.getElementById('applications-count');
        if (applicationsElement) {
            applicationsElement.textContent = data.totalApplications || 0;
        }
        }

        document.getElementById('about-me-text').textContent = data.about;
        document.getElementById('activity-completion').textContent = `${completionPercentage}%`;
        document.getElementById('header-text').textContent = completionPercentage > 20
            ? "Manage your information, track your applications, and improve your matching score"
            : "Welcome! Please complete your profile to unlock full matching features.";

        // 2. Overview Tab
        document.getElementById('preferred-role').textContent = data.career.role || 'N/A';
        document.getElementById('internship-type').textContent = data.career.type;
        document.getElementById('preferred-location').textContent = data.career.location || 'N/A';
        document.getElementById('expected-stipend').textContent = data.career.stipend ? `₹${data.career.stipend}` : 'N/A';
        renderSkills(data.skills);

        // 3. Education & Certifications Tab
        if (data.education && data.education.length > 0) {
            renderListItem('education-item-1', data.education[0], 'fa-graduation-cap');
            if (data.education[1]) renderListItem('education-item-2', data.education[1], 'fa-graduation-cap');
        }

        if (data.certifications && data.certifications.length > 0) {
            renderListItem('certification-item-1', data.certifications[0], 'fa-certificate');
            if (data.certifications[1]) renderListItem('certification-item-2', data.certifications[1], 'fa-certificate');
        }

        // 4. Achievements & Projects Tab
        if (data.achievements && data.achievements.length > 0) {
            renderListItem('achievement-item-1', data.achievements[0], 'fa-award');
            if (data.achievements[1]) renderListItem('achievement-item-2', data.achievements[1], 'fa-award');
        }

        if (data.projects && data.projects.length > 0) {
            renderListItem('project-item-1', data.projects[0], 'fa-project-diagram');
            if (data.projects[1]) renderListItem('project-item-2', data.projects[1], 'fa-project-diagram');
        }


        // 5. Load Modal Inputs (for editing)
        // (Everything below remains unchanged)
        const edu1 = data.education[0] || {};
        const edu2 = data.education[1] || {};
        document.getElementById('edit-degree1').value = edu1.degree || '';
        document.getElementById('edit-period1').value = edu1.period || '';
        document.getElementById('edit-institution1').value = edu1.institution || '';
        document.getElementById('edit-details1').value = edu1.details || '';
        document.getElementById('edit-degree2').value = edu2.degree || '';
        document.getElementById('edit-period2').value = edu2.period || '';
        document.getElementById('edit-institution2').value = edu2.institution || '';
        document.getElementById('edit-details2').value = edu2.details || '';

        const cert1 = data.certifications[0] || {};
        const cert2 = data.certifications[1] || {};
        document.getElementById('edit-cert1').value = cert1.cert_name || '';
        document.getElementById('edit-year1').value = cert1.year || '';
        document.getElementById('edit-org1').value = cert1.issuing_org || '';
        document.getElementById('edit-cert2').value = cert2.cert_name || '';
        document.getElementById('edit-year2').value = cert2.year || '';
        document.getElementById('edit-org2').value = cert2.issuing_org || '';

        const ach1 = data.achievements[0] || {};
        const ach2 = data.achievements[1] || {};
        document.getElementById('edit-ach1-title').value = ach1.title || '';
        document.getElementById('edit-ach1-year').value = ach1.year || '';
        document.getElementById('edit-ach1-event').value = ach1.event_org || '';
        document.getElementById('edit-ach2-title').value = ach2.title || '';
        document.getElementById('edit-ach2-year').value = ach2.year || '';
        document.getElementById('edit-ach2-event').value = ach2.event_org || '';

        const proj1 = data.projects[0] || {};
        const proj2 = data.projects[1] || {};
        document.getElementById('edit-proj1-title').value = proj1.title || '';
        document.getElementById('edit-proj1-year').value = proj1.year || '';
        document.getElementById('edit-proj1-desc').value = proj1.description || '';
        document.getElementById('edit-proj2-title').value = proj2.title || '';
        document.getElementById('edit-proj2-year').value = proj2.year || '';
        document.getElementById('edit-proj2-desc').value = proj2.description || '';
    }

    // ===========================
    // SET PASSWORD FUNCTION
    // ===========================
    document.getElementById('setPasswordForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = localStorage.getItem('current_user_email');
    const newPassword = document.getElementById('newPassword').value.trim();
    const confirmPassword = document.getElementById('confirmPassword').value.trim();

    if (!newPassword || !confirmPassword) {
        showNotification('Please fill in both fields.', 'error');
        return;
    }

    if (newPassword !== confirmPassword) {
        showNotification('Passwords do not match.', 'error');
        return;
    }

    try {
        const response = await fetch('http://localhost:3000/api/profile/set-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, newPassword })
        });

        const result = await response.json();

        if (result.success) {
        showNotification('Password set successfully! You can now log in manually.');
        closeModal('set-password-modal');
        } else {
        showNotification(result.message || 'Error setting password.', 'error');
        }
    } catch (err) {
        console.error('Error:', err);
        showNotification('Could not connect to the server.', 'error');
    }
    });


    // --- UPDATED: initProfile (Now fetches from Backend) ---
    async function initProfile() {
        if (CURRENT_USER_ID === 'default_user' || !CURRENT_USER_ID) {
            showNotification("Error: Please log in to view your profile.", 'error');
            return;
        }
        
        try {
            const response = await fetch(`${API_URL}/get-profile`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: CURRENT_USER_ID })
            });

            if (response.ok) {
                const result = await response.json();
                saveProfileData(result.profile);
                loadProfile(result.profile);
                // 🧩 Dynamically update the Set/Change Password button
                const setPasswordBtn =
                    document.querySelector('.btn.btn-outline.btn-sm i.fa-lock')?.parentElement ||
                    document.querySelector('.btn.btn-outline.btn-sm');

                if (setPasswordBtn) {
                    if (result.hasPassword) {
                        setPasswordBtn.innerHTML = `<i class="fas fa-lock"></i> Change Password`;
                        setPasswordBtn.classList.add('btn-change'); // 🔥 Add a class for styling
                    } else {
                        setPasswordBtn.innerHTML = `<i class="fas fa-lock"></i> Set Password`;
                        setPasswordBtn.classList.remove('btn-change'); // 🧩 Remove if not needed
                    }
                }
                loadUserApplications(); // ✅ Fetch user’s actual internship applications
                showNotification(`Welcome back!`, 'success');
            }
            else if (response.status === 404) {
                const defaultData = defaultProfileData;
                saveProfileData(defaultData);
                loadProfile(defaultData);
                showNotification("Welcome! Please complete your profile to begin matching.", 'warning');
                setTimeout(() => openModal('profile-modal'), 500);
            } else {
                throw new Error('Server responded with an error');
            }
        } catch (error) {
            console.error("Fetch error:", error);
            showNotification('Could not connect to server. Loading local data.', 'error');
            const localData = getProfileData();
            loadProfile(localData);
            loadUserApplications(); // ✅ still load apps even if offline

        }
    }

    // -----------------------------
    // Load user's applications from backend and render into the Applications tab
    // -----------------------------
    async function loadUserApplications() {
    // ensure the container exists in your HTML
    const container = document.getElementById('recentApplications');
    if (!container) {
        console.warn('No #recentApplications container found in HTML — add one to the Applications tab.');
        return;
    }

    // simple loading text while fetching
    container.innerHTML = `<p style="color:#6c757d; text-align:center; padding:18px 0;">Loading your applications...</p>`;

    try {
        const res = await fetch(`${APPLICATION_API}/user/${CURRENT_USER_ID}`);
        if (!res.ok) {
        console.error('Applications API returned', res.status);
        container.innerHTML = `<p style="color:#6c757d; text-align:center; padding:18px 0;">No applications found.</p>`;
        return;
        }

        const data = await res.json();

        if (!data.success || !data.applications || data.applications.length === 0) {
        container.innerHTML = `<p style="color:#6c757d; text-align:center; padding:18px 0;">No applications found.</p>`;
        return;
        }

        // Build HTML for each application (adjust markup/styling as you like)
        container.innerHTML = data.applications.map(app => {
        // guard applied_at
        const appliedOn = app.applied_at ? new Date(app.applied_at).toLocaleString() : '';
        // status -> class
        const status = (app.application_status || 'Pending').toLowerCase();
        const statusClass = status === 'accepted' ? 'status-active' : (status === 'rejected' ? 'status-inactive' : 'status-pending');

        return `
            <div class="application-card" style="display:flex;justify-content:space-between;align-items:center;padding:18px;border-radius:10px;border:1px solid #f0f0f0;margin-bottom:12px;">
            <div>
                <div style="font-weight:600;color:#333;">${escapeHtml(app.internship_title || '')}</div>
                <div style="color:#6c757d;margin-top:4px;">${escapeHtml(app.company_name || '')}</div>
                <div style="color:#6c757d;font-size:0.85rem;margin-top:6px;">Applied on: ${appliedOn}</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:10px;align-items:flex-end;">
                <div class="status ${statusClass}" style="padding:6px 12px;border-radius:20px;font-weight:600;">${escapeHtml(app.application_status || 'Pending')}</div>
                <button class="action-btn btn-view" data-id="${app.application_id}" title="View details" style="background:#f2f4ff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer;">
                <i class="fas fa-eye" style="color:#3a0ca3;"></i>
                </button>
            </div>
            </div>
        `;
        }).join('');

        // OPTIONAL: add event delegation to view buttons if you have a view modal
        container.querySelectorAll('.btn-view').forEach(btn => {
        btn.addEventListener('click', function () {
            const id = this.getAttribute('data-id');
            // If you have a function to show application modal, call it:
            // showApplicationModal(id);
            btn.addEventListener('click', async function () {
            const id = this.getAttribute('data-id');
            try {
                const res = await fetch(`http://localhost:3000/applications/${id}`);
                if (!res.ok) throw new Error('Failed to fetch details');
                const data = await res.json();

                if (data.success && data.application) {
                const app = data.application;

                document.getElementById('detail-title').textContent = app.internship_title || 'N/A';
                document.getElementById('detail-company').textContent = app.company_name || 'N/A';
                document.getElementById('detail-status').textContent = app.application_status || 'Pending';
                const statusEl = document.getElementById('detail-status');
                const statusText = app.application_status || 'Pending';
                statusEl.textContent = statusText;

                // Apply color dynamically
                statusEl.className = ''; // reset previous styles
                if (statusText.toLowerCase() === 'accepted') {
                statusEl.style.background = '#d4edda';
                statusEl.style.color = '#155724';
                statusEl.style.padding = '4px 10px';
                statusEl.style.borderRadius = '12px';
                statusEl.style.fontWeight = '600';
                }
                else if (statusText.toLowerCase() === 'rejected') {
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
                statusEl.style.padding = '4px 10px';
                statusEl.style.borderRadius = '12px';
                statusEl.style.fontWeight = '600';
                }
                else {
                statusEl.style.background = '#fff3cd';
                statusEl.style.color = '#856404';
                statusEl.style.padding = '4px 10px';
                statusEl.style.borderRadius = '12px';
                statusEl.style.fontWeight = '600';
                }
                document.getElementById('detail-date').textContent = app.applied_at ? new Date(app.applied_at).toLocaleString() : 'N/A';
                document.getElementById('detail-desc').textContent = app.description || 'No description available';

                openModal('application-details-modal');
                } else {
                showNotification('Application details not found.', 'warning');
                }
            } catch (err) {
                console.error(err);
                showNotification('Could not load application details.', 'error');
            }
            });
        });
        });

    } catch (err) {
        console.error('Error loading applications:', err);
        container.innerHTML = `<p style="color:red; text-align:center; padding:18px 0;">Error fetching applications.</p>`;
    }
    }

    // small helper to avoid XSS in inserted HTML (useful if you render user content)
    function escapeHtml(str) {
    if (!str) return '';
    return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    
    // NEW: Helper function to calculate completion score
    function calculateCompletion(data) {
        let score = 20; // Base score
        if (data.name !== "New User" && data.title !== "Complete Your Profile Setup") score += 10;
        if (data.phone) score += 5;
        if (data.location) score += 5;
        if (data.picture !== defaultProfileData.picture) score += 10;
        if (data.about !== defaultProfileData.about) score += 10;
        if (data.skills.length > 0) score += 10;
        if (data.career.role) score += 5;
        if (data.education.length > 0) score += 10;
        if (data.certifications.length > 0) score += 5;
        if (data.projects.length > 0) score += 10;
        return Math.min(score, 100); // Cap at 100
    }


    // --- UPDATED: saveFullProfileToBackend (Saves ALL data safely without clearing old fields) ---
async function saveFullProfileToBackend() {
    // 🧠 Step 1: Load existing data first
    const existingData = getProfileData();
    const currentData = { ...existingData }; // copy existing values as base

    // 1. Collect all data from ALL forms (only overwrite if field has a new value)
    const safeValue = (id, fallback = "") => {
        const el = document.getElementById(id);
        return el && el.value ? el.value : fallback;
    };

    currentData.name = safeValue('edit-name', existingData.name);
    currentData.title = safeValue('edit-title', existingData.title);
    currentData.email = safeValue('edit-email', existingData.email);
    currentData.phone = safeValue('edit-phone', existingData.phone);
    currentData.location = safeValue('edit-location', existingData.location);
    currentData.picture = document.getElementById('profile-picture')?.src || existingData.picture;
    currentData.about = safeValue('edit-about', existingData.about);

    // Career (merge instead of replace)
    currentData.career = {
        role: safeValue('edit-role', existingData.career?.role),
        type: safeValue('edit-type', existingData.career?.type),
        location: safeValue('edit-preferred-location', existingData.career?.location),
        stipend: safeValue('edit-stipend', existingData.career?.stipend)
    };

    // Skills
    const skillTags = document.getElementById('skills-container')?.getElementsByClassName('skill-tag') || [];
    if (skillTags.length > 0) {
        currentData.skills = Array.from(skillTags).map(tag => tag.textContent.replace('×', '').trim());
    } else {
        currentData.skills = existingData.skills || [];
    }

    // Education (merge only if fields are filled)
    currentData.education = [];
    if (document.getElementById('edit-degree1')?.value) {
        currentData.education.push({
            degree: safeValue('edit-degree1'),
            period: safeValue('edit-period1'),
            institution: safeValue('edit-institution1'),
            details: safeValue('edit-details1')
        });
    }
    if (document.getElementById('edit-degree2')?.value) {
        currentData.education.push({
            degree: safeValue('edit-degree2'),
            period: safeValue('edit-period2'),
            institution: safeValue('edit-institution2'),
            details: safeValue('edit-details2')
        });
    }
    if (currentData.education.length === 0) {
        currentData.education = existingData.education || [];
    }

    // Certifications
    currentData.certifications = [];
    if (document.getElementById('edit-cert1')?.value) {
        currentData.certifications.push({
            cert_name: safeValue('edit-cert1'),
            year: safeValue('edit-year1'),
            issuing_org: safeValue('edit-org1')
        });
    }
    if (document.getElementById('edit-cert2')?.value) {
        currentData.certifications.push({
            cert_name: safeValue('edit-cert2'),
            year: safeValue('edit-year2'),
            issuing_org: safeValue('edit-org2')
        });
    }
    if (currentData.certifications.length === 0) {
        currentData.certifications = existingData.certifications || [];
    }

    // Achievements
    currentData.achievements = [];
    if (document.getElementById('edit-ach1-title')?.value) {
        currentData.achievements.push({
            title: safeValue('edit-ach1-title'),
            year: safeValue('edit-ach1-year'),
            event_org: safeValue('edit-ach1-event')
        });
    }
    if (document.getElementById('edit-ach2-title')?.value) {
        currentData.achievements.push({
            title: safeValue('edit-ach2-title'),
            year: safeValue('edit-ach2-year'),
            event_org: safeValue('edit-ach2-event')
        });
    }
    if (currentData.achievements.length === 0) {
        currentData.achievements = existingData.achievements || [];
    }

    // Projects
    currentData.projects = [];
    if (document.getElementById('edit-proj1-title')?.value) {
        currentData.projects.push({
            title: safeValue('edit-proj1-title'),
            year: safeValue('edit-proj1-year'),
            description: safeValue('edit-proj1-desc')
        });
    }
    if (document.getElementById('edit-proj2-title')?.value) {
        currentData.projects.push({
            title: safeValue('edit-proj2-title'),
            year: safeValue('edit-proj2-year'),
            description: safeValue('edit-proj2-desc')
        });
    }
    if (currentData.projects.length === 0) {
        currentData.projects = existingData.projects || [];
    }

    // 2. Recalculate Score
    currentData.completionScore = calculateCompletion(currentData);

    // 3. Prepare payload for backend API
    const dataToSend = {
        userId: CURRENT_USER_ID,
        profile: currentData
    };

    try {
        // ⚠️ POST to backend
        const response = await fetch(`${API_URL}/save`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dataToSend),
        });

        const result = await response.json();

        if (response.ok && result.success) {
            // 4. Update localStorage and re-render
            saveProfileData(currentData);
            loadProfile(currentData);

            // Close all open modals
            document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');

            showNotification('Profile updated and saved successfully!');
        } else {
            showNotification(`Save failed: ${result.message}`, 'error');
        }
    } catch (error) {
        console.error('Backend communication error:', error);
        showNotification('Could not connect to the backend server.', 'error');
    }
}


    // --- MODAL ACTION MAPPING (All call the master save function) ---
    function saveProfile() { saveFullProfileToBackend(); }
    function saveAbout() { saveFullProfileToBackend(); }
    function saveSkills() { saveFullProfileToBackend(); }
    function saveCareer() { saveFullProfileToBackend(); }
    function saveEducation() { saveFullProfileToBackend(); }
    function saveCertifications() { saveFullProfileToBackend(); }
    function saveAchievements() { saveFullProfileToBackend(); }
    function saveProjects() { saveFullProfileToBackend(); }

    // NEW: Function for the profile picture modal
    // ✅ Updated: Function for the profile picture modal (handles PNG/JPG safely)
async function saveProfilePicture() {
  const fileInput = document.getElementById('file-input');
  const file = fileInput.files[0];

  // 🟢 Case 1: If user selected an avatar (preset)
  if (selectedAvatarUrl && !file) {
    document.getElementById('profile-picture').src = selectedAvatarUrl;
    await saveFullProfileToBackend();
    showNotification('Avatar selected successfully!');
    closeModal('profile-picture-modal');
    return;
  }

  // 🟢 Case 2: If user uploaded a file
  if (file) {
    if (!['image/jpeg', 'image/png'].includes(file.type)) {
      showNotification('Please upload a JPG or PNG image.', 'error');
      return;
    }

    if (file.size > 2 * 1024 * 1024) { // > 2MB
      showNotification('Image too large! Please keep below 2MB.', 'error');
      return;
    }

    try {
      // 🧠 Resize & convert to JPEG (fix PNG errors)
      const resizedBase64 = await resizeAndConvertImage(file);

      // Preview it
      document.getElementById('profile-picture').src = resizedBase64;

      // Update local + backend
      const currentData = getProfileData();
      currentData.picture = resizedBase64;
      saveProfileData(currentData);
      await saveFullProfileToBackend();

      showNotification('Profile picture updated successfully!');
      closeModal('profile-picture-modal');
    } catch (err) {
      console.error('Error saving picture:', err);
      showNotification('Error processing image. Please try again.', 'error');
    }
  } else {
    showNotification('Please choose or upload an image.', 'error');
  }
}
// 🧩 Helper: Resize and convert image (handles PNG safely)
function resizeAndConvertImage(file, maxWidth = 400, maxHeight = 400, quality = 0.85) {
  return new Promise((resolve) => {
    const img = new Image();
    const reader = new FileReader();

    reader.onload = (e) => {
      img.src = e.target.result;
      img.onload = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        let width = img.width;
        let height = img.height;

        // Proportionally resize
        if (width > height && width > maxWidth) {
          height *= maxWidth / width;
          width = maxWidth;
        } else if (height > maxHeight) {
          width *= maxHeight / height;
          height = maxHeight;
        }

        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);

        // 🔥 Convert to JPEG — this fixes PNG-related issues
        const newBase64 = canvas.toDataURL('image/jpeg', quality);
        resolve(newBase64);
      };
    };

    reader.readAsDataURL(file);
  });
}

    // --- Other Helper Functions ---

    document.addEventListener('DOMContentLoaded', initProfile);

    // Modal functionality
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
    }
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    window.onclick = function (event) {
        const modals = document.getElementsByClassName('modal');
        for (let i = 0; i < modals.length; i++) {
            if (event.target == modals[i]) {
                modals[i].style.display = 'none';
            }
        }
    }

    let selectedAvatarUrl = '';
    function selectAvatar(element, url) {
        const avatars = document.querySelectorAll('.avatar-option');
        avatars.forEach(avatar => avatar.classList.remove('selected'));
        element.classList.add('selected');
        selectedAvatarUrl = url;
    }

    function addSkill() {
        const newSkill = document.getElementById('new-skill').value.trim();
        if (newSkill) {
            const skillTag = document.createElement('div');
            skillTag.className = 'skill-tag';
            skillTag.innerHTML = `${newSkill} <span class="remove-skill" onclick="removeSkill(this)">×</span>`;
            document.getElementById('skills-container').appendChild(skillTag);
            document.getElementById('new-skill').value = '';
        }
    }
    function removeSkill(element) {
        element.parentElement.remove();
    }

    // Tab switching functionality
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            // Deactivate all
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Activate clicked
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
        });
    });

    </script>
</body>
</html>

